import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as j}from"./index-BE4Fbmwm.js";import{T as F}from"./Text-C1JEmKLm.js";import{C as H}from"./Checkbox-ANUpOvAS.js";import{I as p}from"./IconButton-C0fDNSGz.js";import{A as C}from"./Icons-DkmbEqGT.js";import{I as L}from"./Input-D5j9VKnD.js";import{B as O}from"./Button-DDqaEZzK.js";import{M as Y}from"./Modal-m-eMx2ej.js";import{u as $,v as G}from"./PomodoroContext-BZZk-DrD.js";import{c as Q}from"./compiler-runtime-CJbQ6yvW.js";function U(c){const t=Q.c(5);let m;t[0]!==c?(m=()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia(c).matches:!1,t[0]=c,t[1]=m):m=t[1];const[w,g]=j.useState(m);let i,h;return t[2]!==c?(i=()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const f=window.matchMedia(c),u=()=>g(f.matches);return f.addEventListener("change",u),()=>f.removeEventListener("change",u)},h=[c],t[2]=c,t[3]=i,t[4]=h):(i=t[3],h=t[4]),j.useEffect(i,h),w}const J="_list_17byg_1",K="_taskRowWrapper_17byg_11",V="_chevronWrapper_17byg_15",X="_task_17byg_11",Z="_left_17byg_40",q="_taskContent_17byg_46",oo="_completed_17byg_52",eo="_pomodoroWrapper_17byg_57",so="_pomodoroIcons_17byg_63",to="_modalContent_17byg_73",lo="_modalHeader_17byg_81",no="_modalTitleRow_17byg_87",ao="_modalTitle_17byg_87",ro="_modalActions_17byg_103",co="_modalDelete_17byg_109",n={list:J,taskRowWrapper:K,chevronWrapper:V,task:X,left:Z,taskContent:q,completed:oo,pomodoroWrapper:eo,pomodoroIcons:so,modalContent:to,modalHeader:lo,modalTitleRow:no,modalTitle:ao,modalActions:ro,modalDelete:co},mo=({onDeleteTask:c})=>{const{tasks:t,setTasks:m,mode:w,setGlobalPomodoros:g}=$(),[i,h]=j.useState(!1),[f,u]=j.useState(null),T=U("(max-width: 600px)"),I=t.filter(o=>!o.completed),M=[...t].reverse().find(o=>o.completed),A=t.filter(o=>o.completed),y=t.length<=1||!i?[...I,...A]:I.length>0?[I[0]]:[M].filter(Boolean),z=o=>{const r=new Date().toISOString(),s=t.find(d=>d.id===o),l=!s.completed;if(m(d=>d.map(a=>a.id===o?{...a,completed:l,completedPomodoros:l?a.pomodoros:Math.min(a.completedPomodoros,a.previousCompletedPomodoros??0),...l?{previousCompletedPomodoros:a.completedPomodoros}:{previousCompletedPomodoros:void 0}}:a)),l)g(d=>[...d,...Array.from({length:s.pomodoros},()=>({id:G(),completedAt:r,taskId:o}))]);else{const d=new Date;g(a=>{const x=[...a];let b=0;const E=s.completedPomodoros;return x.filter(D=>{const P=new Date(D.completedAt),S=P.getFullYear()===d.getFullYear()&&P.getMonth()===d.getMonth()&&P.getDate()===d.getDate(),B=D.taskId===o;return S&&B&&b<E?(b++,!1):!0})})}t.every(d=>d.id===o?!s.completed:d.completed)&&h(!1)},k=o=>{c(o)},_=o=>{m(r=>r.map(s=>s.id===o&&s.pomodoros<4?{...s,pomodoros:s.pomodoros+1,completed:!1}:s))},N=o=>{m(r=>r.map(s=>{if(s.id!==o||s.pomodoros<=1)return s;const l=s.pomodoros-1;return{...s,pomodoros:l,completedPomodoros:Math.min(s.completedPomodoros,l),completed:!1}}))},R=(o,r)=>{m(s=>s.map(l=>l.id===o?{...l,title:r}:l))},W=()=>{if(!f)return null;const o=t.find(l=>l.id===f);if(!o)return null;const r=C.sparkle,s=C.sparkles;return e.jsxs("div",{className:n.modalContent,children:[e.jsxs("div",{className:n.modalHeader,children:[e.jsxs("div",{className:n.modalTitleRow,children:[e.jsx(F,{className:n.modalTitle,children:o.title}),e.jsx("div",{className:n.pomodoroIcons,children:[...Array(o.pomodoros)].map((l,v)=>{const d=o.completed||v<o.completedPomodoros?s:r;return e.jsx(d,{size:16},v)})})]}),e.jsx(p,{icon:"close",label:"Close",size:"big","data-testid":"modal-close-button",onClick:()=>u(null)})]}),e.jsxs("div",{className:n.modalActions,children:[e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"big",variant:"danger",disabled:o.pomodoros<=1,onClick:()=>N(o.id)}),e.jsx(p,{icon:"add",label:"Add pomodoro",size:"big",variant:"success",disabled:o.pomodoros>=4,onClick:()=>_(o.id)})]}),e.jsx("div",{className:n.modalDelete,children:e.jsx(O,{size:"default",onClick:()=>{k(o),u(null)},children:"Delete Task"})})]})};return e.jsxs("div",{className:n.list,children:[y==null?void 0:y.map((o,r)=>{const s=`task-${o.id}`,l=r===0&&t.length>1,v=C.sparkle,d=C.sparkles;return e.jsxs("div",{className:l?n.taskRowWrapper:void 0,children:[l&&e.jsx("div",{className:n.chevronWrapper,children:!T&&e.jsx(p,{icon:i?"chevronDown":"chevronUp",onClick:()=>h(a=>!a),label:i?"Show all tasks":"Collapse tasks",size:"medium"})}),e.jsxs("div",{className:n.task,children:[e.jsxs("div",{className:n.left,children:[e.jsxs("div",{className:n.taskContent,children:[e.jsx(H,{id:s,label:o.title,checked:o.completed,onChange:()=>z(o.id),mode:w}),e.jsx(L,{value:o.title,size:o.title.length||1,onChange:a=>R(o.id,a.target.value),borderless:!0,width:"265px",className:o.completed?n.completed:""})]}),e.jsxs("div",{className:n.pomodoroWrapper,children:[!T&&e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"small",variant:"danger",disabled:o.pomodoros<=1,onClick:()=>N(o.id)}),e.jsx(p,{icon:"add",label:"Add pomodoro",size:"small",variant:"success",disabled:o.pomodoros>=4,onClick:()=>_(o.id)})]}),e.jsx("div",{className:n.pomodoroIcons,children:[...Array(o.pomodoros)].map((a,x)=>{const b=o.completed||x<o.completedPomodoros?d:v;return e.jsx(b,{size:16},x)})})]})]}),T?e.jsx(p,{icon:"moreHorizontal",label:"More options",size:"small",onClick:()=>u(o.id)}):e.jsx(p,{icon:"trash",label:"Delete task",size:"small",variant:"danger",onClick:()=>k(o)})]})]},o.id)}),e.jsx(Y,{isOpen:!!f,onClose:()=>u(null),position:"bottom",children:W()})]})};mo.__docgenInfo={description:"",methods:[],displayName:"TaskList"};export{mo as T};
