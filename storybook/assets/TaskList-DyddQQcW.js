import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as j}from"./index-BE4Fbmwm.js";import{T as F}from"./Text-C1JEmKLm.js";import{C as H}from"./Checkbox-CwjQxxzy.js";import{I as p}from"./IconButton-Du-sIps7.js";import{A as b}from"./Icons-B7uN4MAq.js";import{I as L}from"./Input-D5j9VKnD.js";import{B as O}from"./Button-DDqaEZzK.js";import{M as Y}from"./Modal-Bo1S5ewd.js";import{u as $,v as G}from"./PomodoroContext-BZZk-DrD.js";import{c as Q}from"./compiler-runtime-CJbQ6yvW.js";function U(c){const t=Q.c(5);let m;t[0]!==c?(m=()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia(c).matches:!1,t[0]=c,t[1]=m):m=t[1];const[w,g]=j.useState(m);let i,h;return t[2]!==c?(i=()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const f=window.matchMedia(c),v=()=>g(f.matches);return f.addEventListener("change",v),()=>f.removeEventListener("change",v)},h=[c],t[2]=c,t[3]=i,t[4]=h):(i=t[3],h=t[4]),j.useEffect(i,h),w}const J="_list_17byg_1",K="_taskRowWrapper_17byg_11",V="_chevronWrapper_17byg_15",X="_task_17byg_11",Z="_left_17byg_40",q="_taskContent_17byg_46",oo="_completed_17byg_52",eo="_pomodoroWrapper_17byg_57",so="_pomodoroIcons_17byg_63",to="_modalContent_17byg_73",lo="_modalHeader_17byg_81",no="_modalTitleRow_17byg_87",ro="_modalTitle_17byg_87",ao="_modalActions_17byg_103",co="_modalDelete_17byg_109",d={list:J,taskRowWrapper:K,chevronWrapper:V,task:X,left:Z,taskContent:q,completed:oo,pomodoroWrapper:eo,pomodoroIcons:so,modalContent:to,modalHeader:lo,modalTitleRow:no,modalTitle:ro,modalActions:ao,modalDelete:co},mo=({onDeleteTask:c})=>{const{tasks:t,setTasks:m,mode:w,setGlobalPomodoros:g}=$(),[i,h]=j.useState(!1),[f,v]=j.useState(null),T=U("(max-width: 600px)"),I=t.filter(o=>!o.completed),M=[...t].reverse().find(o=>o.completed),A=t.filter(o=>o.completed),y=t.length<=1||!i?[...I,...A]:I.length>0?[I[0]]:[M].filter(Boolean),z=o=>{const a=new Date().toISOString(),s=t.find(n=>n.id===o),l=!s.completed;if(m(n=>n.map(r=>r.id===o?{...r,completed:l,completedPomodoros:l?r.pomodoros:Math.min(r.completedPomodoros,r.previousCompletedPomodoros??0),...l?{previousCompletedPomodoros:r.completedPomodoros}:{previousCompletedPomodoros:void 0}}:r)),l)g(n=>[...n,...Array.from({length:s.pomodoros},()=>({id:G(),completedAt:a,taskId:o}))]);else{const n=new Date;g(r=>{const x=[...r];let C=0;const E=s.completedPomodoros;return x.filter(D=>{const k=new Date(D.completedAt),S=k.getFullYear()===n.getFullYear()&&k.getMonth()===n.getMonth()&&k.getDate()===n.getDate(),B=D.taskId===o;return S&&B&&C<E?(C++,!1):!0})})}t.every(n=>n.id===o?!s.completed:n.completed)&&h(!1)},P=o=>{c(o)},_=o=>{m(a=>a.map(s=>s.id===o&&s.pomodoros<4?{...s,pomodoros:s.pomodoros+1,completed:!1}:s))},N=o=>{m(a=>a.map(s=>{if(s.id!==o||s.pomodoros<=1)return s;const l=s.pomodoros-1;return{...s,pomodoros:l,completedPomodoros:Math.min(s.completedPomodoros,l),completed:!1}}))},R=(o,a)=>{m(s=>s.map(l=>l.id===o?{...l,title:a}:l))},W=()=>{if(!f)return null;const o=t.find(l=>l.id===f);if(!o)return null;const a=b.sparkle,s=b.sparkles;return e.jsxs("div",{className:d.modalContent,children:[e.jsxs("div",{className:d.modalHeader,children:[e.jsxs("div",{className:d.modalTitleRow,children:[e.jsx(F,{className:d.modalTitle,children:o.title}),e.jsx("div",{className:d.pomodoroIcons,children:[...Array(o.pomodoros)].map((l,u)=>{const n=o.completed||u<o.completedPomodoros?s:a;return e.jsx(n,{size:16},u)})})]}),e.jsx(p,{icon:"close",label:"Close",size:"big",onClick:()=>v(null)})]}),e.jsxs("div",{className:d.modalActions,children:[e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"big",variant:"danger",disabled:o.pomodoros<=1,onClick:()=>N(o.id)}),e.jsx(p,{icon:"add",label:"Add pomodoro",size:"big",variant:"success",disabled:o.pomodoros>=4,onClick:()=>_(o.id)})]}),e.jsx("div",{className:d.modalDelete,children:e.jsx(O,{size:"default",onClick:()=>{P(o),v(null)},children:"Delete Task"})})]})};return e.jsxs("div",{className:d.list,children:[y==null?void 0:y.map((o,a)=>{const s=`task-${o.id}`,l=a===0&&t.length>1,u=b.sparkle,n=b.sparkles;return e.jsxs("div",{className:l?d.taskRowWrapper:void 0,children:[l&&e.jsx("div",{className:d.chevronWrapper,children:!T&&e.jsx(p,{icon:i?"chevronDown":"chevronUp",onClick:()=>h(r=>!r),label:i?"Show all tasks":"Collapse tasks",size:"medium"})}),e.jsxs("div",{className:d.task,children:[e.jsxs("div",{className:d.left,children:[e.jsxs("div",{className:d.taskContent,children:[e.jsx(H,{id:s,checked:o.completed,onChange:()=>z(o.id),mode:w}),e.jsx(L,{value:o.title,size:o.title.length||1,onChange:r=>R(o.id,r.target.value),borderless:!0,width:"265px",className:o.completed?d.completed:""})]}),e.jsxs("div",{className:d.pomodoroWrapper,children:[!T&&e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"small",variant:"danger",disabled:o.pomodoros<=1,onClick:()=>N(o.id)}),e.jsx(p,{icon:"add",label:"Add pomodoro",size:"small",variant:"success",disabled:o.pomodoros>=4,onClick:()=>_(o.id)})]}),e.jsx("div",{className:d.pomodoroIcons,children:[...Array(o.pomodoros)].map((r,x)=>{const C=o.completed||x<o.completedPomodoros?n:u;return e.jsx(C,{size:16},x)})})]})]}),T?e.jsx(p,{icon:"moreHorizontal",label:"More options",size:"small",onClick:()=>v(o.id)}):e.jsx(p,{icon:"trash",label:"Delete task",size:"small",variant:"danger",onClick:()=>P(o)})]})]},o.id)}),e.jsx(Y,{isOpen:!!f,onClose:()=>v(null),children:W()})]})};mo.__docgenInfo={description:"",methods:[],displayName:"TaskList"};export{mo as T};
