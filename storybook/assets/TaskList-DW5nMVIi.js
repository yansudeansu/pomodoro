import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as z}from"./index-BE4Fbmwm.js";import{C as F}from"./Checkbox-CwjQxxzy.js";import{I as i}from"./IconButton-DLG4f09V.js";import{A as P}from"./Icons-LTYywjph.js";import{I as M}from"./Input-DrSQa85y.js";import{u as S}from"./PomodoroContext-DcQYR8jO.js";import{v as B}from"./v4-C6aID195.js";const E="_list_1m3ya_1",L="_taskRowWrapper_1m3ya_11",Y="_chevronWrapper_1m3ya_15",G="_task_1m3ya_11",O="_left_1m3ya_40",U="_taskContent_1m3ya_46",$="_completed_1m3ya_52",q="_pomodoroWrapper_1m3ya_57",H="_pomodoroIcons_1m3ya_63",l={list:E,taskRowWrapper:L,chevronWrapper:Y,task:G,left:O,taskContent:U,completed:$,pomodoroWrapper:q,pomodoroIcons:H},J=({onDeleteTask:y})=>{const{tasks:n,setTasks:a,mode:w,setGlobalPomodoros:u}=S(),[h,x]=z.useState(!1),C=n.filter(o=>!o.completed),g=[...n].reverse().find(o=>o.completed),v=n.length<=1||!h?n:C.length>0?C.slice(0,1):g&&[g],W=o=>{const d=new Date().toISOString(),e=n.find(r=>r.id===o),t=!e.completed;if(a(r=>r.map(m=>m.id===o?{...m,completed:t,completedPomodoros:t?m.pomodoros:Math.min(m.completedPomodoros,m.previousCompletedPomodoros??0),...t?{previousCompletedPomodoros:m.completedPomodoros}:{previousCompletedPomodoros:void 0}}:m)),t)u(r=>[...r,...Array.from({length:e.pomodoros},()=>({id:B(),completedAt:d,taskId:o}))]);else{const r=new Date;u(m=>{const c=[...m];let p=0;const b=e.completedPomodoros;return c.filter(I=>{const f=new Date(I.completedAt),A=f.getFullYear()===r.getFullYear()&&f.getMonth()===r.getMonth()&&f.getDate()===r.getDate(),R=I.taskId===o;return A&&R&&p<b?(p++,!1):!0})})}n.every(r=>r.id===o?!e.completed:r.completed)&&x(!1)},T=o=>{y(o)},D=o=>{a(d=>d.map(e=>e.id===o&&e.pomodoros<4?{...e,pomodoros:e.pomodoros+1,completed:!1}:e))},N=o=>{a(d=>d.map(e=>{if(e.id!==o||e.pomodoros<=1)return e;const t=e.pomodoros-1;return{...e,pomodoros:t,completedPomodoros:Math.min(e.completedPomodoros,t),completed:!1}}))},k=(o,d)=>{a(e=>e.map(t=>t.id===o?{...t,title:d}:t))};return s.jsx("div",{className:l.list,children:v==null?void 0:v.map((o,d)=>{const e=`task-${o.id}`,t=d===0&&n.length>1,j=P.sparkle,r=P.sparkles;return s.jsxs("div",{className:t?l.taskRowWrapper:void 0,children:[t&&s.jsx("div",{className:l.chevronWrapper,children:s.jsx(i,{icon:h?"chevronDown":"chevronUp",onClick:()=>x(m=>!m),label:h?"Show all tasks":"Collapse tasks",size:"medium"})}),s.jsxs("div",{className:l.task,children:[s.jsxs("div",{className:l.left,children:[s.jsxs("div",{className:l.taskContent,children:[s.jsx(F,{id:e,checked:o.completed,onChange:()=>W(o.id),mode:w}),s.jsx(M,{value:o.title,size:o.title.length||1,onChange:m=>k(o.id,m.target.value),borderless:!0,width:"265px",className:o.completed?l.completed:""})]}),s.jsxs("div",{className:l.pomodoroWrapper,children:[s.jsx("div",{className:l.pomodoroIcons,children:[...Array(o.pomodoros)].map((m,c)=>{const p=o.completed||c<o.completedPomodoros?r:j;return s.jsx(p,{size:16},c)})}),o.pomodoros>1&&s.jsx(i,{icon:"remove",label:"Remove pomodoro",size:"small",variant:"danger",onClick:()=>N(o.id)}),o.pomodoros<4&&s.jsx(i,{icon:"add",label:"Add pomodoro",size:"small",variant:"success",onClick:()=>D(o.id)})]})]}),s.jsx(i,{icon:"trash",label:"Delete task",size:"small",variant:"danger",onClick:()=>T(o)})]})]},o.id)})})};J.__docgenInfo={description:"",methods:[],displayName:"TaskList"};export{J as T};
