import{j as y}from"./jsx-runtime-D_zvdyIk.js";import{c as L}from"./compiler-runtime-CJbQ6yvW.js";import{M as E}from"./ModeSwitcher-nd9cisJJ.js";import{p as T,T as C}from"./TimerControls-CFVGTO47.js";import{T as P}from"./TimerDisplay-vjCVDni9.js";import{P as I}from"./ProgressRing-DOSM5Dml.js";import{T as j}from"./Text-C1JEmKLm.js";import{I as q}from"./InfoTooltip-BKuPgeHb.js";import{u as x,v as M}from"./PomodoroContext-BZZk-DrD.js";import{r}from"./index-BE4Fbmwm.js";const D="_container_6qrrh_1",N="_titleRow_6qrrh_9",g={container:D,titleRow:N};function V(){const e=L.c(2),[i,d]=r.useState($);let c,t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{const _=()=>{d(document.visibilityState==="visible")};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},t=[],e[0]=c,e[1]=t):(c=e[0],t=e[1]),r.useEffect(c,t),i}function $(){return document.visibilityState==="visible"}function A(e){const i=V(),[d,c]=r.useState(!1),[t,_]=r.useState(null),b=r.useRef(!1),p=r.useRef(!1),s=typeof navigator<"u"&&"wakeLock"in navigator,k=r.useRef(e),n=r.useCallback((o,a)=>{var f,R;(R=(f=k.current)==null?void 0:f.onError)==null||R.call(f,o,a)},[]),l=r.useCallback(o=>{var a,f;(f=(a=k.current)==null?void 0:a.onLock)==null||f.call(a,o)},[]),u=r.useCallback(o=>{var a,f;(f=(a=k.current)==null?void 0:a.onRelease)==null||f.call(a,o)},[]),m=r.useCallback(async()=>{if(s&&!(b.current||t&&!t.released)){p.current=!1,b.current=!0;try{const o=await navigator.wakeLock.request("screen");o.addEventListener("release",()=>{c(!1),u(o)}),_(o),c(!0),l(o)}catch(o){n(o instanceof Error?o:new Error("Unknown request error"),"request")}finally{b.current=!1}}},[s,t,l,u,n]),h=r.useCallback(async()=>{if(!(!s||!t))try{p.current=!0,await t.release()}catch(o){n(o instanceof Error?o:new Error("Unknown release error"),"release")}},[s,t,n]);return r.useEffect(()=>{s&&i&&(t!=null&&t.released)&&!p.current&&m()},[i,s,t,m]),r.useMemo(()=>({isSupported:s,isLocked:d,request:m,release:h}),[s,d,m,h])}function B(e,i=Date.now()){return Math.round(((e??i)-i)/1e3)}const O=()=>{const{isRunning:e,setIsRunning:i,setTimeLeft:d,timeLeft:c,mode:t,setMode:_,pomodoroCount:b,setPomodoroCount:p,incrementCompletedPomodoros:s,setGlobalPomodoros:k}=x(),n=r.useRef(null),l=r.useRef(!1),u=r.useRef(!1),m=r.useRef(null),{request:h,release:o}=A({onError:(R,v)=>console.warn(`[WakeLock ${v}] ${R.message}`)}),a=()=>{n.current&&(clearInterval(n.current),n.current=null)},f=()=>{if(t==="pomodoro"){const R=b+1;p(R),_(R%4===0?"long_break":"short_break")}else _("pomodoro")};r.useEffect(()=>{if(a(),e){h();const R=Date.now(),v=c;m.current=R+v*1e3,l.current=!1,u.current=!1,n.current=setInterval(()=>{const w=B(m.current,Date.now());w<=0?(l.current||(T(),l.current=!0),Notification.permission==="granted"&&new Notification("Time's up!",{body:t==="pomodoro"?"Take a short break!":"Ready to focus? Start your next Pomodoro!"}),!u.current&&t==="pomodoro"&&(s(),k(S=>[...S,{id:M(),completedAt:new Date().toISOString()}]),u.current=!0),a(),o(),d(0),i(!1),f()):d(w)},1e3)}else o();return()=>{a(),o()}},[e])},U=()=>{const e=L.c(16);O();const{timeLeft:i,mode:d}=x();let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c={pomodoro:"Pomodoro",short_break:"Short Break",long_break:"Long Break"},e[0]=c):c=e[0];const t=c[d],b=1-i/(d==="pomodoro"?1500:d==="short_break"?300:900);let p;e[1]===Symbol.for("react.memo_cache_sentinel")?(p=y.jsx(E,{}),e[1]=p):p=e[1];let s;e[2]!==t?(s=y.jsx(j,{variant:"label",children:t}),e[2]=t,e[3]=s):s=e[3];let k;e[4]===Symbol.for("react.memo_cache_sentinel")?(k=y.jsx(q,{}),e[4]=k):k=e[4];let n;e[5]!==s?(n=y.jsxs("div",{className:g.titleRow,children:[s,k]}),e[5]=s,e[6]=n):n=e[6];let l;e[7]!==i?(l=y.jsx(P,{time:i}),e[7]=i,e[8]=l):l=e[8];let u;e[9]!==b||e[10]!==l?(u=y.jsx(I,{radius:120,stroke:6,progress:b,children:l}),e[9]=b,e[10]=l,e[11]=u):u=e[11];let m;e[12]===Symbol.for("react.memo_cache_sentinel")?(m=y.jsx(C,{}),e[12]=m):m=e[12];let h;return e[13]!==n||e[14]!==u?(h=y.jsxs("div",{className:g.container,children:[p,n,u,m]}),e[13]=n,e[14]=u,e[15]=h):h=e[15],h};U.__docgenInfo={description:"",methods:[],displayName:"PomodoroTimer"};export{U as P};
