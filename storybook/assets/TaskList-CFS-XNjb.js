import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as j}from"./index-BE4Fbmwm.js";import{T as H}from"./Text-C1JEmKLm.js";import{C as B}from"./Checkbox-CwjQxxzy.js";import{I as p}from"./IconButton-Du-sIps7.js";import{A as b}from"./Icons-B7uN4MAq.js";import{I as F}from"./Input-D5j9VKnD.js";import{B as L}from"./Button-DDqaEZzK.js";import{M as O}from"./Modal-Bo1S5ewd.js";import{u as Y,v as $}from"./PomodoroContext-BZZk-DrD.js";import{c as G}from"./compiler-runtime-CJbQ6yvW.js";function Q(c){const t=G.c(5);let m;t[0]!==c?(m=()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia(c).matches:!1,t[0]=c,t[1]=m):m=t[1];const[w,g]=j.useState(m);let i,h;return t[2]!==c?(i=()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const f=window.matchMedia(c),v=()=>g(f.matches);return f.addEventListener("change",v),()=>f.removeEventListener("change",v)},h=[c],t[2]=c,t[3]=i,t[4]=h):(i=t[3],h=t[4]),j.useEffect(i,h),w}const U="_list_17byg_1",J="_taskRowWrapper_17byg_11",K="_chevronWrapper_17byg_15",V="_task_17byg_11",X="_left_17byg_40",Z="_taskContent_17byg_46",q="_completed_17byg_52",oo="_pomodoroWrapper_17byg_57",eo="_pomodoroIcons_17byg_63",so="_modalContent_17byg_73",to="_modalHeader_17byg_81",lo="_modalTitleRow_17byg_87",no="_modalTitle_17byg_87",ro="_modalActions_17byg_103",ao="_modalDelete_17byg_109",d={list:U,taskRowWrapper:J,chevronWrapper:K,task:V,left:X,taskContent:Z,completed:q,pomodoroWrapper:oo,pomodoroIcons:eo,modalContent:so,modalHeader:to,modalTitleRow:lo,modalTitle:no,modalActions:ro,modalDelete:ao},co=({onDeleteTask:c})=>{const{tasks:t,setTasks:m,mode:w,setGlobalPomodoros:g}=Y(),[i,h]=j.useState(!1),[f,v]=j.useState(null),T=Q("(max-width: 600px)"),P=t.filter(o=>!o.completed),k=[...t].reverse().find(o=>o.completed),I=t.length<=1||!i?t:P.length>0?P.slice(0,1):k&&[k],A=o=>{const a=new Date().toISOString(),s=t.find(n=>n.id===o),l=!s.completed;if(m(n=>n.map(r=>r.id===o?{...r,completed:l,completedPomodoros:l?r.pomodoros:Math.min(r.completedPomodoros,r.previousCompletedPomodoros??0),...l?{previousCompletedPomodoros:r.completedPomodoros}:{previousCompletedPomodoros:void 0}}:r)),l)g(n=>[...n,...Array.from({length:s.pomodoros},()=>({id:$(),completedAt:a,taskId:o}))]);else{const n=new Date;g(r=>{const x=[...r];let C=0;const W=s.completedPomodoros;return x.filter(M=>{const y=new Date(M.completedAt),E=y.getFullYear()===n.getFullYear()&&y.getMonth()===n.getMonth()&&y.getDate()===n.getDate(),S=M.taskId===o;return E&&S&&C<W?(C++,!1):!0})})}t.every(n=>n.id===o?!s.completed:n.completed)&&h(!1)},_=o=>{c(o)},N=o=>{m(a=>a.map(s=>s.id===o&&s.pomodoros<4?{...s,pomodoros:s.pomodoros+1,completed:!1}:s))},D=o=>{m(a=>a.map(s=>{if(s.id!==o||s.pomodoros<=1)return s;const l=s.pomodoros-1;return{...s,pomodoros:l,completedPomodoros:Math.min(s.completedPomodoros,l),completed:!1}}))},z=(o,a)=>{m(s=>s.map(l=>l.id===o?{...l,title:a}:l))},R=()=>{if(!f)return null;const o=t.find(l=>l.id===f);if(!o)return null;const a=b.sparkle,s=b.sparkles;return e.jsxs("div",{className:d.modalContent,children:[e.jsxs("div",{className:d.modalHeader,children:[e.jsxs("div",{className:d.modalTitleRow,children:[e.jsx(H,{className:d.modalTitle,children:o.title}),e.jsx("div",{className:d.pomodoroIcons,children:[...Array(o.pomodoros)].map((l,u)=>{const n=o.completed||u<o.completedPomodoros?s:a;return e.jsx(n,{size:16},u)})})]}),e.jsx(p,{icon:"close",label:"Close",size:"big",onClick:()=>v(null)})]}),e.jsxs("div",{className:d.modalActions,children:[e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"big",variant:"danger",disabled:o.pomodoros<=1,onClick:()=>D(o.id)}),e.jsx(p,{icon:"add",label:"Add pomodoro",size:"big",variant:"success",disabled:o.pomodoros>=4,onClick:()=>N(o.id)})]}),e.jsx("div",{className:d.modalDelete,children:e.jsx(L,{size:"default",onClick:()=>{_(o),v(null)},children:"Delete Task"})})]})};return e.jsxs("div",{className:d.list,children:[I==null?void 0:I.map((o,a)=>{const s=`task-${o.id}`,l=a===0&&t.length>1,u=b.sparkle,n=b.sparkles;return e.jsxs("div",{className:l?d.taskRowWrapper:void 0,children:[l&&e.jsx("div",{className:d.chevronWrapper,children:e.jsx(p,{icon:i?"chevronDown":"chevronUp",onClick:()=>h(r=>!r),label:i?"Show all tasks":"Collapse tasks",size:"medium"})}),e.jsxs("div",{className:d.task,children:[e.jsxs("div",{className:d.left,children:[e.jsxs("div",{className:d.taskContent,children:[e.jsx(B,{id:s,checked:o.completed,onChange:()=>A(o.id),mode:w}),e.jsx(F,{value:o.title,size:o.title.length||1,onChange:r=>z(o.id,r.target.value),borderless:!0,width:"265px",className:o.completed?d.completed:""})]}),e.jsxs("div",{className:d.pomodoroWrapper,children:[!T&&o.pomodoros>1&&e.jsx(p,{icon:"remove",label:"Remove pomodoro",size:"small",variant:"danger",onClick:()=>D(o.id)}),e.jsx("div",{className:d.pomodoroIcons,children:[...Array(o.pomodoros)].map((r,x)=>{const C=o.completed||x<o.completedPomodoros?n:u;return e.jsx(C,{size:16},x)})}),!T&&o.pomodoros<4&&e.jsx(p,{icon:"add",label:"Add pomodoro",size:"small",variant:"success",onClick:()=>N(o.id)})]})]}),T?e.jsx(p,{icon:"moreHorizontal",label:"More options",size:"small",onClick:()=>v(o.id)}):e.jsx(p,{icon:"trash",label:"Delete task",size:"small",variant:"danger",onClick:()=>_(o)})]})]},o.id)}),e.jsx(O,{isOpen:!!f,onClose:()=>v(null),children:R()})]})};co.__docgenInfo={description:"",methods:[],displayName:"TaskList"};export{co as T};
