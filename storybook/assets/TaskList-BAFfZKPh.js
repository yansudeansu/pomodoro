import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as R}from"./index-BE4Fbmwm.js";import{C as z}from"./Checkbox-CwjQxxzy.js";import{I as i}from"./IconButton-DLG4f09V.js";import{A as P}from"./Icons-LTYywjph.js";import{I as F}from"./Input-BWAoh5qY.js";import{u as M}from"./PomodoroContext-DcQYR8jO.js";import{v as S}from"./v4-C6aID195.js";const B="_list_1xgeq_1",E="_taskRowWrapper_1xgeq_11",L="_chevronWrapper_1xgeq_15",Y="_task_1xgeq_11",G="_left_1xgeq_40",O="_taskContent_1xgeq_46",U="_completed_1xgeq_52",$="_pomodoroWrapper_1xgeq_57",H="_pomodoroIcons_1xgeq_63",n={list:B,taskRowWrapper:E,chevronWrapper:L,task:Y,left:G,taskContent:O,completed:U,pomodoroWrapper:$,pomodoroIcons:H},J=({onDeleteTask:w})=>{const{tasks:m,setTasks:c,mode:W,setGlobalPomodoros:g}=M(),[h,f]=R.useState(!1),u=m.filter(o=>!o.completed),C=[...m].reverse().find(o=>o.completed),v=m.length<=1||!h?m:u.length>0?u.slice(0,1):C&&[C],T=o=>{const l=new Date().toISOString(),e=m.find(r=>r.id===o),t=!e.completed;if(c(r=>r.map(d=>d.id===o?{...d,completed:t,completedPomodoros:t?d.pomodoros:Math.min(d.completedPomodoros,d.previousCompletedPomodoros??0),...t?{previousCompletedPomodoros:d.completedPomodoros}:{previousCompletedPomodoros:void 0}}:d)),t)g(r=>[...r,...Array.from({length:e.pomodoros},()=>({id:S(),completedAt:l,taskId:o}))]);else{const r=new Date;g(d=>{const p=[...d];let a=0;const b=e.completedPomodoros;return p.filter(I=>{const x=new Date(I.completedAt),y=x.getFullYear()===r.getFullYear()&&x.getMonth()===r.getMonth()&&x.getDate()===r.getDate(),A=I.taskId===o;return y&&A&&a<b?(a++,!1):!0})})}m.every(r=>r.id===o?!e.completed:r.completed)&&f(!1)},D=o=>{w(o)},N=o=>{c(l=>l.map(e=>e.id===o&&e.pomodoros<4?{...e,pomodoros:e.pomodoros+1,completed:!1}:e))},k=o=>{c(l=>l.map(e=>{if(e.id!==o||e.pomodoros<=1)return e;const t=e.pomodoros-1;return{...e,pomodoros:t,completedPomodoros:Math.min(e.completedPomodoros,t),completed:!1}}))},q=(o,l)=>{c(e=>e.map(t=>t.id===o?{...t,title:l}:t))};return s.jsx("div",{className:n.list,children:v==null?void 0:v.map((o,l)=>{const e=`task-${o.id}`,t=l===0&&m.length>1,j=P.sparkle,r=P.sparkles;return s.jsxs("div",{className:t?n.taskRowWrapper:void 0,children:[t&&s.jsx("div",{className:n.chevronWrapper,children:s.jsx(i,{icon:h?"chevronDown":"chevronUp",onClick:()=>f(d=>!d),label:h?"Show all tasks":"Collapse tasks",size:"medium"})}),s.jsxs("div",{className:n.task,children:[s.jsxs("div",{className:n.left,children:[s.jsxs("div",{className:n.taskContent,children:[s.jsx(z,{id:e,checked:o.completed,onChange:()=>T(o.id),mode:W}),s.jsx(F,{value:o.title,size:o.title.length||1,onChange:d=>q(o.id,d.target.value),borderless:!0,width:"265px",className:o.completed?n.completed:""})]}),s.jsxs("div",{className:n.pomodoroWrapper,children:[s.jsx("div",{className:n.pomodoroIcons,children:[...Array(o.pomodoros)].map((d,p)=>{const a=o.completed||p<o.completedPomodoros?r:j;return s.jsx(a,{size:16},p)})}),o.pomodoros>1&&s.jsx(i,{icon:"remove",label:"Remove pomodoro",size:"small",variant:"danger",onClick:()=>k(o.id)}),o.pomodoros<4&&s.jsx(i,{icon:"add",label:"Add pomodoro",size:"small",variant:"success",onClick:()=>N(o.id)})]})]}),s.jsx(i,{icon:"trash",label:"Delete task",size:"small",variant:"danger",onClick:()=>D(o)})]})]},o.id)})})};J.__docgenInfo={description:"",methods:[],displayName:"TaskList"};export{J as T};
